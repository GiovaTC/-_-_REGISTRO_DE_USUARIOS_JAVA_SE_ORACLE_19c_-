-- table users .
CREATE TABLE USERS (
    ID            NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRST_NAME    VARCHAR2(50),
    LAST_NAME     VARCHAR2(50),
    EMAIL         VARCHAR2(100),
    PHONE         VARCHAR2(20),
    USERNAME      VARCHAR2(50),
    PASSWORD      VARCHAR2(100),
    ROLE          VARCHAR2(50),
    STATUS        VARCHAR2(20)
);

COMMIT;

-- store procedure SP_USERS_CRUD .
CREATE OR REPLACE PROCEDURE SP_USERS_CRUD (
    P_ACTION      IN VARCHAR2,
    P_ID          IN NUMBER,
    P_FIRST_NAME  IN VARCHAR2,
    P_LAST_NAME   IN VARCHAR2,
    P_EMAIL       IN VARCHAR2,
    P_PHONE       IN VARCHAR2,
    P_USERNAME    IN VARCHAR2,
    P_PASSWORD    IN VARCHAR2,
    P_ROLE        IN VARCHAR2,
    P_STATUS      IN VARCHAR2,
    P_CURSOR      OUT SYS_REFCURSOR
)
AS
BEGIN
    IF P_ACTION = 'INSERT' THEN
        INSERT INTO USERS (FIRST_NAME, LAST_NAME, EMAIL, PHONE, USERNAME, PASSWORD, ROLE, STATUS)
        VALUES (P_FIRST_NAME, P_LAST_NAME, P_EMAIL, P_PHONE, P_USERNAME, P_PASSWORD, P_ROLE, P_STATUS);
        OPEN P_CURSOR FOR SELECT * FROM USERS;

    ELSIF P_ACTION = 'UPDATE' THEN
        UPDATE USERS
        SET FIRST_NAME = P_FIRST_NAME,
            LAST_NAME  = P_LAST_NAME,
            EMAIL      = P_EMAIL,
            PHONE      = P_PHONE,
            USERNAME   = P_USERNAME,
            PASSWORD   = P_PASSWORD,
            ROLE       = P_ROLE,
            STATUS     = P_STATUS
        WHERE ID = P_ID;
        OPEN P_CURSOR FOR SELECT * FROM USERS;

    ELSIF P_ACTION = 'DELETE' THEN
        DELETE FROM USERS WHERE ID = P_ID;
        OPEN P_CURSOR FOR SELECT * FROM USERS;

    ELSIF P_ACTION = 'SELECT' THEN
        OPEN P_CURSOR FOR SELECT * FROM USERS;
    END IF;
END;
/

COMMIT;
